(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{144:function(e){e.exports=JSON.parse('{"name":"Rnchat","displayName":"Rnchat","senderID":"594331487245","connectyCubeConfig":[{"appId":218,"authKey":"p-cqm2aatn8ZPM3","authSecret":"3hmGuXN8AHZOgg6"},{"chat":{"streamManagement":{"enable":true}},"debug":{"mode":1}}]}')},145:function(e,t,a){e.exports=a.p+"static/media/logo_with_text.34ab4cf5.png"},149:function(e,t,a){e.exports=a(363)},194:function(e,t){},212:function(e,t){},214:function(e,t){},237:function(e,t){},239:function(e,t){},248:function(e,t){},250:function(e,t){},284:function(e,t){},285:function(e,t){},287:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=287},318:function(e,t,a){},319:function(e,t,a){},321:function(e,t,a){},331:function(e,t,a){},352:function(e,t,a){},353:function(e,t,a){},354:function(e,t,a){},355:function(e,t,a){},356:function(e,t,a){},357:function(e,t,a){},358:function(e,t,a){},359:function(e,t,a){},360:function(e,t,a){},361:function(e,t,a){},362:function(e,t,a){},363:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(57),i=a.n(s),o=a(1),c=a.n(o),l=a(10),u=a(2),d=a(6),h=a(13),m=a(12),g=a(14),p=a(43),f=a(36),v=a(44),E=a(8),y=a.n(E);function _(e){return e?y.a.storage.privateUrl(e):null}var b=function(){function e(t){Object(u.a)(this,e),this.id=t._id||t.id,this.type=t.type,this.xmpp_room_jid=t.xmpp_room_jid,this.xmpp_type=3===t.type?"chat":t.type?"groupchat":"",this.name=t.name,this.photo=e.getAvatarUrl(t.photo),this.description=t.description,this.destination=t.xmpp_room_jid||t.room_jid,this.user_id=t.user_id,this.admins_ids=t.admins_ids,this.occupants_ids=t.occupants_ids,this.updated_date=Date.parse(t.updated_at)||Date.now(),this.last_message_date_sent=t.last_message_date_sent||Date.parse(t.updated_at)/1e3||Date.parse(t.created_at)/1e3,this.last_message=t.last_message||"",this.last_message_id=t.last_message_id,this.last_message_user_id=t.last_message_user_id,this.unread_messages_count=t.unread_messages_count,this.unread_messages_ids=t.unread_messages_ids,this.pinned_messages_ids=t.pinned_messages_ids}return Object(d.a)(e,null,[{key:"getAvatarUrl",value:function(e){return _(e)}}]),e}(),S=function(e){return{type:"FETCH_DIALOGS",dialogs:e}},w=function(e){return{type:"UPDATE_DIALOG",dialog:e}},O=function(e){return{type:"ADD_DIALOG",dialog:e}},k=function(e,t){return{type:"SORT_DIALOGS",message:e,count:t}},j=function(e,t,a){return{type:"UPDATE_MESSAGES",dialogId:e,msgId:t,msg:a}},x=function(e,t){return{type:"PUSH_MESSAGE",message:e,dialogId:t}},U=function(e){return{type:"FETCH_USERS",users:e}},D=a(49),C=a(20),I=function(e){return{type:"SET_CURRENT_USER",currentUser:e}},N=a(37),M=a(39),L=function(e,t){var a=t.map((function(t){return t.id===e.dialog.id?Object.assign(t,e.dialog):t}));return Object(N.a)(a)},A=function(e,t){var a=e.history.reverse().concat(t[e.dialogId]);return Object(C.a)({},{},Object(M.a)({},e.dialogId,a))},R=function(e,t){var a=e.message,n=e.count,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.sort((function(e,a){var n=new Date(1e3*a.last_message_date_sent)-new Date(1e3*e.last_message_date_sent);return t?!n:n}))}(t.map((function(e){if(e.id===a.dialog_id){var t={last_message:a.body,last_message_date_sent:a.date_sent,updated_date:a.date_sent,unread_messages_count:n?e.unread_messages_count+=1:e.unread_messages_count};return Object.assign(e,t)}return e})));return Object(N.a)(r)},P=function(e,t){if(0===Object.keys(t).length)return t;var a=t[e.dialogId].map((function(t,a){if(t.id===e.msgId){var n=Object(C.a)({},t);return n.send_state=e.msg.send_state,Object(C.a)({},n)}return t}));return Object(C.a)({},t,Object(M.a)({},e.dialogId,a))},T=function(e,t){var a={};return e.forEach((function(e){a[e.id]=e})),Object(C.a)({},t,{},a)},F=Object(D.b)({currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_USER":return t.currentUser;case"UPDATE_CURRENT_USER":var a=Object.assign(e.user,t.currentUser);return e.user=a,Object(C.a)({},e);case"RESET_CURRENT_USER":return null;default:return e}},dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_DIALOGS":return t.dialogs;case"UPDATE_DIALOG":var a=L(t,e);return a;case"ADD_DIALOG":return[t.dialog].concat(Object(N.a)(e));case"SORT_DIALOGS":var n=R(t,e);return n;case"DELETE_DIALOG":var r=e.filter((function(e){return e.id!==t.dialogId}));return r;default:return e}},selectedDialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECTED_DIALOG":return Object(C.a)({},t.dialog);case"UN_SELECTED_DIALOG":return{};default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_MESSAGES":var a=t.history;return Object(C.a)({},e,Object(M.a)({},t.dialogId,a.reverse()));case"LAZY_FETCH_MESSAGES":var n=A(t,e);return n;case"UPDATE_MESSAGES":var r=P(t,e);return r;case"PUSH_MESSAGE":return Object(C.a)({},e,Object(M.a)({},t.dialogId,[].concat(Object(N.a)(e[t.dialogId]||[]),[t.message])));case"DELETE_ALL_MESSAGES":return Object(C.a)({},e,Object(M.a)({},t.dialogId,[]));default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_USERS":return T(t.users,e);default:return e}}}),z=function(e,t){return"RESSET_STORE"===t.type&&(e={}),F(e,t)},W=Object(D.c)(z),B="create",H={id:"",body:"",dialog_id:"",date_sent:Math.floor(Date.now()/1e3),attachments:null,sender_id:null,sender:null},G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,a=arguments.length>1?arguments[1]:void 0;Object(u.a)(this,e),this.id=t.id||t._id,this.body=t.body||t.message,this.group_chat_alert_type=t.group_chat_alert_type||null,this.dialog_id=t.chat_dialog_id||t.extension&&t.extension.dialog_id,this.date_sent=t.date_sent||t.extension&&t.extension.date_sent||Math.floor(Date.now()/1e3),this.send_state=e.getSendState(t,a),this.attachment=e.getAttachment(t),this.sender_id=t.sender_id||t.extension&&t.extension.sender_id,this.sender=t.sender_id}return Object(d.a)(e,null,[{key:"getAttachment",value:function(e){var t;if(e.attachments&&e.attachments.length>0){var a=Object(C.a)({},e.attachments[0]),n=_(e.attachments[0].uid);return a.url=n,[a]}if((null===e||void 0===e?void 0:null===(t=e.extension)||void 0===t?void 0:t.attachments)&&e.extension.attachments.length>0){var r=Object(C.a)({},e.extension.attachments[0]),s=_(e.extension.attachments[0].uid);return r.url=s,[r]}return null}},{key:"getSendState",value:function(e,t){var a,n;return(null===e||void 0===e?void 0:null===(a=e.read_ids)||void 0===a?void 0:a.find((function(e){return e!==t})))?3:(null===e||void 0===e?void 0:null===(n=e.delivered_ids)||void 0===n?void 0:n.find((function(e){return e.delivered_ids!==t})))?2:0}}]),e}(),q=function e(t){Object(u.a)(this,e),this.attachment=t.extension.attachments,this.body=t.body,this.date_sent=t.extension.date_sent,this.dialog_id=t.extension.dialog_id,this.id=t.id,this.send_state=0,this.sender=void 0,this.sender_id=t.extension.sender_id},Y=function(){function e(t){Object(u.a)(this,e),this.id=t.id,this.avatar=e.getAvatarUrl(t.avatar),this.login=t.login,this.custom_data=t.custom_data?t.custom_data:"",this.full_name=t.full_name||t.login,this.phone=t.phone,this.created_at=t.created_at,this.updated_at=t.updated_at,this.last_request_at=t.last_request_at}return Object(d.a)(e,null,[{key:"getAvatarUrl",value:function(e){return _(e)}}]),e}(),J=3,K=2,Z=new(function(){function e(){var t=this;Object(u.a)(this,e),this.getMoreMessages=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r,s,i,o,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getMessagesByDialogId(a.id),r=n[0],s=Object.assign(a,{last_messages_for_fetch:r.date_sent}),i={chat_dialog_id:a.id,date_sent:{lt:r.date_sent},sort_desc:"date_sent"},e.next=6,y.a.chat.message.list(i);case 6:return o=e.sent,l=[],o.items.forEach((function(e){e.group_chat_alert_type||l.push(new G(e,t.currentUser.id))})),W.dispatch(w(s)),u=W.dispatch({type:"LAZY_FETCH_MESSAGES",dialogId:a.id,history:l}),e.abrupt("return",u.history.length);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendMsgChatAlertOnCreate=function(){var e=Object(l.a)(c.a.mark((function e(a,n,r){var s,i,o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=Math.floor(Date.now()/1e3),i=a.type===J?a.occupants_ids.find((function(e){return e!=t.currentUser.id})):a.xmpp_room_jid,o={date_sent:s,save_to_history:1,dialog_id:a.id,group_chat_alert_type:r,sender_id:t.currentUser.id},l={type:a.xmpp_room_jid?"groupchat":"chat",body:n,extension:o},y.a.chat.send(i,l);case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.updateDialogsUnreadMessagesCount=function(e){var t=Object.assign(e,{unread_messages_count:0});return W.dispatch(w(t)),!0}}return Object(d.a)(e,[{key:"setUpListeners",value:function(){y.a.chat.onMessageListener=this.onMessageListener.bind(this),y.a.chat.onSentMessageCallback=this.onSentMessageListener.bind(this),y.a.chat.onDeliveredStatusListener=this.onDeliveredStatus.bind(this),y.a.chat.onReadStatusListener=this.onReadStatus.bind(this)}},{key:"fetchDialogsFromServer",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,n,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===W.getState().dialogs.length){e.next=2;break}return e.abrupt("return",W.getState().dialogs);case 2:return e.next=4,y.a.chat.dialog.list();case 4:if(t=e.sent,a=this.currentUser,n=[],r=t.items.map((function(e){return e.type===J&&e.occupants_ids.forEach((function(e){e!==a.id&&n.push(e)})),new b(e)})),0===n.length){e.next=13;break}return e.next=11,this.getUsersList(n);case 11:s=e.sent,W.dispatch(U(s));case 13:return W.dispatch(S(r)),e.abrupt("return",W.getState().dialogs);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,i,o,l,u=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.getMessagesByDialogId(t.id),n=null,!(!t.isAlreadyMessageFetch||t.unread_messages_count>0&&!t.isAlreadyMessageFetch)){e.next=14;break}return e.next=5,y.a.chat.message.list({chat_dialog_id:t.id,sort_desc:"date_sent"});case 5:r=e.sent,s=[],r.items.forEach((function(e){e.group_chat_alert_type||s.push(new G(e,u.currentUser.id))})),i=Object.assign(t,{isAlreadyMessageFetch:!0}),this.updateDialogsUnreadMessagesCount(i),W.dispatch({type:"FETCH_MESSAGES",dialogId:t.id,history:s}),n=s.length,e.next=22;break;case 14:if(!(t.unread_messages_count>0)){e.next=21;break}return o=this.getMessagesByDialogId(t.id),l=o[t.unread_messages_count-1],this.readAllMessages(t.id),e.next=20,this.sendReadStatus(l.id,l.sender_id,l.dialog_id);case 20:this.updateDialogsUnreadMessagesCount(t);case 21:n=a.length;case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){var n,r,s,i,o,l,u,d,h,m=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>2&&void 0!==m[2]&&m[2],r=m.length>3?m[3]:void 0,s=this.currentUser,i=a.trim(),o=Math.floor(Date.now()/1e3),l=t.type===J?t.occupants_ids.find((function(e){return e!=s.id})):t.xmpp_room_jid,(u={type:t.xmpp_type,body:i,extension:{save_to_history:1,dialog_id:t.id,sender_id:s.id,date_sent:o}}).id=this.messageUniqueId,!n){e.next=10;break}return e.abrupt("return",this.sendMessageAsAttachment(t,l,u,n,r));case 10:return d=new q(u),h=Object.freeze(d),e.next=14,W.dispatch(x(h,t.id));case 14:r(),y.a.chat.send(l,u),W.dispatch(k(h));case 17:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"sendChatAlertOnCreate",value:function(e){this.sendMsgChatAlertOnCreate(e,"Group is created",B)}},{key:"sendMessageAsAttachment",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a,n,r,s){var i,o,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=URL.createObjectURL(r.file),n.extension.attachments=[{url:i}],n.body="Image attachment",o=new q(n),e.next=6,W.dispatch(x(o,t.id));case 6:return s(),e.next=9,this.uploadPhoto(r);case 9:return l=e.sent,u={size:(c=l).size,uid:c.uid,type:c.content_type,name:c.name,width:400,height:400},n.extension.attachments=[u],e.next=14,y.a.chat.send(a,n);case 14:return W.dispatch(k(o)),e.abrupt("return");case 16:case"end":return e.stop()}var c}),e,this)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()},{key:"createPrivateDialog",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=W.getState().dialogs,n=null,a.forEach((function(e){e.type===J&&e.occupants_ids.find((function(e){return e===t}))&&(n=e)})),n){e.next=21;break}return r={type:J,occupants_ids:t},e.next=7,y.a.chat.dialog.create(r);case 7:if(s=e.sent,n=new b(s),!this.getUserFromReduxById(t)){e.next=14;break}return W.dispatch(O(n)),e.abrupt("return",n);case 14:return e.next=16,this.getUserFromServerById(t);case 16:return(i=e.sent).user=new Y(i.user),W.dispatch(U([i.user])),W.dispatch(O(n)),e.abrupt("return",n);case 21:if(!this.getUserFromReduxById(t)){e.next=25;break}return e.abrupt("return",n);case 25:return e.next=27,this.getUserFromServerById(t);case 27:return(o=e.sent).user=new Y(o.user),W.dispatch(U([o.user])),e.abrupt("return",n);case 31:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createPublicDialog",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a,n){var r,s,i,o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.currentUser,t.unshift(r.id),s={type:K,occupants_ids:t,name:a},!n){e.next=9;break}return e.next=6,this.uploadPhoto(n);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=null;case 10:return(i=e.t0)&&(s.photo=i.uid),e.next=14,y.a.chat.dialog.create(s);case 14:return o=e.sent,l=new b(o),W.dispatch(O(l)),e.abrupt("return",l);case 18:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"readAllMessages",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.chat.message.update(null,{chat_dialog_id:t,read:1}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"readMessage",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.onReadStatus(t,a),e.abrupt("return",y.a.chat.message.update(null,{chat_dialog_id:a,read:1}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onMessageListener",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){var n,r,s,i,o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new G(a),s=this.currentUser,i=null===(n=this.getSelectedDialog())||void 0===n?void 0:n.id,!a.extension.group_chat_alert_type){e.next=10;break}return e.next=6,y.a.chat.dialog.list();case 6:return o=e.sent,l=o.items.map((function(e){return new b(e)})),W.dispatch(S(l)),e.abrupt("return");case 10:t!==s.id&&(i===r.dialog_id?(W.dispatch(k(r)),this.readMessage(r.id,r.dialog_id),this.sendReadStatus(a.extension.message_id,a.extension.sender_id,a.dialog_id)):(this.sendDeliveredStatus(a.extension.message_id,a.extension.sender_id,a.dialog_id),W.dispatch(k(r,!0))),W.dispatch(x(r,r.dialog_id)));case 11:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onSentMessageListener",value:function(e,t){console.warn("onSentMessageListener"),e||t.extension.group_chat_alert_type||W.dispatch(j(t.extension.dialog_id,t.id,{send_state:1}))}},{key:"onDeliveredStatus",value:function(e,t,a){console.warn("onDeliveredStatus",e),W.dispatch(j(t,e,{send_state:2}))}},{key:"onReadStatus",value:function(e,t,a){console.warn("onReadStatus",e),W.dispatch(j(t,e,{send_state:3}))}},{key:"sendReadStatus",value:function(e,t,a){y.a.chat.sendReadStatus({messageId:e,userId:t,dialogId:a})}},{key:"sendDeliveredStatus",value:function(e,t,a){y.a.chat.sendDeliveredStatus({messageId:e,userId:t,dialogId:a})}},{key:"getUsersList",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.users.get({per_page:100,filter:{field:"id",param:"in",value:t}});case 2:return a=e.sent,e.abrupt("return",a.items.map((function(e){return new Y(e.user)})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserFromServerById",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.users.get(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSelectDialog",value:function(e){W.dispatch(function(e){return{type:"SELECTED_DIALOG",dialog:e}}(e))}},{key:"getSelectedDialog",value:function(){return W.getState().selectedDialog}},{key:"getDialogById",value:function(e){return W.getState().dialogs.find((function(t){return t.id===e}))}},{key:"getMessagesByDialogId",value:function(e){return W.getState().messages[e]}},{key:"uploadPhoto",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.storage.createAndUpload(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserFromReduxById",value:function(e){return W.getState().users[e]}},{key:"currentUser",get:function(){return W.getState().currentUser.user}},{key:"messageUniqueId",get:function(){return y.a.chat.helpers.getBsonObjectId()}}]),e}());Object.freeze(Z);var V=Z,X=(a(317),a(144)),$=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,[{key:"init",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.init.apply(y.a,Object(N.a)(X.connectyCubeConfig));case 2:return e.abrupt("return",this.autologin());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"autologin",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserSession();case 2:if(!(t=e.sent)){e.next=10;break}return a=JSON.parse(t),e.next=7,this.signIn({login:a.login,password:a.password});case 7:return e.abrupt("return","home");case 10:return e.abrupt("return","auth");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signIn",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.createSession(t);case 2:a=e.sent,n=new Y(a.user),a.user.avatar=_(a.user.avatar),a.user.full_name=a.user.login,W.dispatch(I(a)),r=Object.assign({},n,{password:t.password}),this.setUserSession(r),this.connect(r.id,r.password);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signUp",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.createSession();case 2:return e.next=4,y.a.users.signup(t);case 4:return e.abrupt("return",this.signIn(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.chat.connect({userId:t,password:a});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setUserSession",value:function(t){return localStorage.setItem(e.CURRENT_USER_SESSION_KEY,JSON.stringify(t))}},{key:"getUserSession",value:function(){return localStorage.getItem(e.CURRENT_USER_SESSION_KEY)}},{key:"logout",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,y.a.logout();case 3:W.dispatch({type:"RESSET_STORE"});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();$.CURRENT_USER_SESSION_KEY="CURRENT_USER_SESSION_KEY",$.DEVICE_TOKEN_KEY="DEVICE_TOKEN_KEY";var Q=new $;Object.freeze(Q);var ee=Q,te=a(145),ae=a.n(te),ne=a(29),re=a.n(ne),se=(a(318),a(319),function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"container-loader"},r.a.createElement("div",{className:"loader"}))}}]),t}(n.Component)),ie=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={isLogin:!0,isLoader:!1,full_name:"",login:"",password:"",isAuthorization:!1},a.handleStateModal=function(){return a.setState({isLogin:!a.state.isLogin})},a.changeName=function(e){return a.setState({full_name:e.target.value})},a.changeLogin=function(e){return a.setState({login:e.target.value})},a.changePassword=function(e){return a.setState({password:e.target.value})},a.login=function(e){e.preventDefault();var t=a.state,n=t.login,r=t.password,s=t.full_name,i=t.isLogin,o={login:n,password:r};if(n.trim()&&r.trim()&&(i||s.trim()))a.setState({isLoader:!0}),i?ee.signIn(o).then((function(){a.setState({isLoader:!1,isAuthorization:!0})})).catch((function(e){a.setState({isLoader:!1}),re()("Error.\n\n".concat(JSON.stringify(e)),"","error")})):(o.full_name=s,ee.signUp(o).then((function(){a.setState({isLoader:!1,isAuthorization:!0}),re()("Account successfully registered!","","success")})).catch((function(e){a.setState({isLoader:!1}),re()("Error.\n\n".concat(JSON.stringify(e)),"","error")})));else{var c=i?"login.":"sign up";re()("Warning","Fill the fields to ".concat(c))}},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.state,t=e.isLogin,a=e.login,n=e.password,s=e.isLoader,i=e.isAuthorization,o=e.full_name,c=t?"Don't have an account?":"Already have an account?",l=t?"Sign up":"Sign in";return r.a.createElement("div",{className:"auth-main-\u0441ontainer",style:this.props.isSmallDevice&&{backgroundColor:"#27ae60"}},r.a.createElement("div",{className:"auth-modal-container",style:t?{height:"500px"}:{height:"570px"}},s&&r.a.createElement("div",{className:"auth-wrapp-loader"},r.a.createElement(se,null)),i&&r.a.createElement(v.a,{to:"/home"}),r.a.createElement("div",{className:"auth-logo"},r.a.createElement("img",{src:ae.a,alt:"Logo"})),r.a.createElement("form",{onSubmit:this.login,className:"auth-form auth-wrapper"},!t&&r.a.createElement("input",{type:"text",value:o,onChange:this.changeName,required:!0,placeholder:"Name",name:"Name"}),r.a.createElement("input",{type:"text",value:a,onChange:this.changeLogin,required:!0,placeholder:"Login",name:"login"}),r.a.createElement("input",{type:"password",value:n,onChange:this.changePassword,required:!0,placeholder:"Password",name:"Password"}),r.a.createElement("button",{type:"submit",value:"Submit"},t?"Log in":"Sign up")),r.a.createElement("div",{className:"auth-footer"},r.a.createElement("span",null,c),r.a.createElement("a",{onClick:this.handleStateModal},l))))}}]),t}(n.Component),oe=a(365),ce=a(366),le=a(11),ue=a(4),de=(a(321),a(50)),he=a.n(de);a(331);function me(e){var t=e.photo,a=e.name,n=e.size;return t?r.a.createElement("div",{style:{width:n,height:n}},r.a.createElement("div",{style:{width:n||"100%",height:n||"100%",borderRadius:"50%",backgroundImage:"url(".concat(t,")"),backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}})):r.a.createElement("div",{style:{width:n,height:n}},r.a.createElement("div",{className:"avatar-as-icon",style:{backgroundColor:function(){var e=["blue","darkmagenta","fuchsia","gold","green","limegreen","navy","purple","red","skyblue"];return e[a.length%e.length]}()}},r.a.createElement("p",{style:{fontSize:n/2.4}},function(){var e=a.split(" ");return e.length>1?"".concat(e[0].slice(0,1)).concat(e[1].slice(0,1)):a.slice(0,2)}().toUpperCase())))}var ge=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).customStyles={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)",border:"none",padding:0}},a.showMoreInformation=function(){a.setState({isModal:!a.state.isModal})},a.handleCloseModal=function(){return a.setState({isModal:!1})},a.logOut=function(){ee.logout()},a.settings=function(){alert("Coming soon"),a.handleCloseModal()},a.state={isModal:!1},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.state.isModal,t=this.props.currentUser;if(!t)return r.a.createElement(r.a.Fragment,null);var a=t.user;return r.a.createElement("div",{className:"user-rofile-container"},r.a.createElement("div",{className:"user-profile-wrapper"},r.a.createElement("div",{className:"user-profile-user-info"},r.a.createElement("div",{className:"online"},r.a.createElement(me,{photo:a.avatar,name:a.full_name,size:50})),r.a.createElement("span",null,a.full_name)),r.a.createElement("div",{className:"user-profile-icon",id:"user-profile-icon",onClick:this.showMoreInformation},e?r.a.createElement(le.a,{icon:ue.h,color:"white"}):r.a.createElement(le.a,{icon:ue.f,color:"#435f7a"}))),e&&r.a.createElement(r.a.Fragment,null,r.a.createElement(he.a,{isOpen:e,onRequestClose:this.handleCloseModal,ariaHideApp:!1,style:this.customStyles,overlayClassName:"Overlay-user-profile"}),r.a.createElement("div",{className:"user-profile-modal"},r.a.createElement("ul",null,r.a.createElement("li",{className:"user-profile-user-more-info"},r.a.createElement(f.b,{to:"/auth",onClick:this.logOut,className:"reset-user-profile"},"Logout")),r.a.createElement("li",{className:"user-profile-user-more-info"},r.a.createElement(f.b,{to:"/home",onClick:this.settings,className:"reset-user-profile"},"Settings"))))))}}]),t}(n.Component),pe=Object(p.b)((function(e){return{currentUser:e.currentUser}}))(ge),fe=a(40),ve=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"getDialogLayoutProvider",value:function(e){return new fe.LayoutProvider((function(){return"type"}),(function(t,a){a.width=e,a.height=75}))}}]),e}(),Ee=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"getChatLayoutProvider",value:function(e){var t=e.width,a=e.dialogId,n=e.currentUserId,r=new ye(t);return new fe.LayoutProvider((function(e){return e}),(function(e,s,i){if(W.getState().messages[a][i].attachment)return s.width=t,void(s.height=300);var o;o=W.getState().messages[a][i].sender_id===n?r.currentSender:r.otherSender;var c=document.createElement("canvas").getContext("2d");c.font="".concat(16,"px 'Open Sans', sans-serif");var l=W.getState().messages[a][i].body,u=c.measureText(l).width,d=Math.ceil(u/(o-20));s.width=t,s.height=1.5*d*16+30+15}))}}]),e}(),ye=function e(t){Object(u.a)(this,e),t<550&&(this.currentSender=300,this.otherSender=250),t>550&&t<768&&(this.currentSender=420,this.otherSender=470),t>768&&t<960&&(this.currentSender=450,this.otherSender=500),t>960&&(this.currentSender=650,this.otherSender=600)};function _e(e){var t=e?new Date(1e3*e):new Date,a=t.getHours(),n=t.getMinutes();return"".concat(a>9?a:"0"+a,":").concat(n>9?n:"0"+n)}a(352);var be=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).scrollWidth=0,a.scrollHeight=0,a.listenerWindowSize=null,a.timer=null,a.allDialog=[],a.handleResize=function(){a.scrollWidth=document.getElementById("dialog-info-container").clientWidth,a.scrollHeight=document.getElementById("dialog-info-container").clientHeight,a.timer||(a.timer=setTimeout((function(){clearTimeout(a.timer),a.timer=null,a.setState({isAlredy:!0,layoutProvider:ve.getDialogLayoutProvider(a.scrollWidth)})}),500))},a.changeSearch=function(e){var t=[];""===e.target.value?t=a.allDialog:a.allDialog.forEach((function(a){a.name.toUpperCase().includes(e.target.value.toUpperCase())&&t.push(a)})),a.setState({search:e.target.value,dataProvider:a.state.dataProvider.cloneWithRows(t)})},a.goToChat=function(e){var t=a.props.router;V.setSelectDialog(e),t("/home/chat")},a.createNewDialog=function(){(0,a.props.router)("/home/create-dialog")},a._renderDialog=function(e,t){return r.a.createElement("li",{onClick:function(){return a.goToChat(t)}},r.a.createElement("div",{className:"dialog-wrap-avatar"},r.a.createElement(me,{photo:t.photo,name:t.name,size:50})),r.a.createElement("div",{className:"dialog-wrap-block"},r.a.createElement("div",{className:"dialog-wrap-block-left"},r.a.createElement("h5",null,t.name),r.a.createElement("span",null,""===t.last_message?"No messages yet":t.last_message)),r.a.createElement("div",{className:"dialog-wrap-block-right"},r.a.createElement("p",null,function(e){var t=e.lastDate,a=e.lastMessage,n=e.updatedDate,r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=a?new Date(1e3*t):new Date(n),i=s.getFullYear(),o=s.getMonth(),c=s.getDate(),l=s.getDay(),u=s.getHours(),d=s.getMinutes(),h=new Date,m=h.getFullYear(),g=h.getMonth(),p=h.getDate(),f=h.getDay();return m>i?"".concat(r[o]," ").concat(c,", ").concat(i):g>o?"".concat(r[o]," ").concat(c):p>c+6?"".concat(r[o]," ").concat(c):f>l?"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][l]):"".concat(u>9?u:"0"+u,":").concat(d>9?d:"0"+d)}({lastDate:t.last_message_date_sent,lastMessage:t.last_message,updatedDate:t.updated_date})),t.unread_messages_count>0&&r.a.createElement("span",null,t.unread_messages_count))))},a.state={isAlredy:!1,dataProvider:new fe.DataProvider((function(e,t){return e!==t||e.unread_messages_count!==t.unread_messages_count})),layoutProvider:0,count:20,isLoader:!0,search:""},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleResize),this.scrollWidth=document.getElementById("dialog-info-container").clientWidth,this.scrollHeight=document.getElementById("dialog-info-container").clientHeight,V.fetchDialogsFromServer().then((function(t){e.allDialog=t,e.setState({isAlredy:!0,isLoader:!1,layoutProvider:ve.getDialogLayoutProvider(e.scrollWidth),dataProvider:e.state.dataProvider.cloneWithRows(t)})}))}},{key:"componentDidUpdate",value:function(e){var t=this.props.dialogs;this.props.dialogs!==e.dialogs&&(this.allDialog=t,this.setState({layoutProvider:ve.getDialogLayoutProvider(this.scrollWidth),dataProvider:this.state.dataProvider.cloneWithRows(t)}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this.state,t=e.isLoader,a=e.dataProvider,n=e.layoutProvider,s=e.search;return r.a.createElement("div",{className:"dialog-container"},r.a.createElement("button",{onClick:this.createNewDialog},r.a.createElement(le.a,{icon:ue.p,color:"#d2d2d2"}),r.a.createElement("span",null,"New chat")),r.a.createElement("div",{className:"dialog-input-search"},r.a.createElement("div",{className:"dialog-input-search-icon"},r.a.createElement(le.a,{icon:ue.m,color:"#d2d2d2"})),r.a.createElement("input",{className:"input-field",type:"text",value:s,onChange:this.changeSearch,required:!0,placeholder:"Search chats...",name:"search"})),r.a.createElement("div",{className:"dialog-info-container",id:"dialog-info-container"},t?r.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%"}},r.a.createElement(se,null)):0===a.length?r.a.createElement("div",{className:"dialog-no-chats"},r.a.createElement("h3",null,"No chats yet")):this.state.isAlredy?a._data.length>0?r.a.createElement("ul",null,r.a.createElement(fe.RecyclerListView,{style:{width:this.scrollWidth,height:this.scrollHeight},dataProvider:a,layoutProvider:n,rowRenderer:this._renderDialog})):r.a.createElement("div",{className:"dialog-no-chats"},r.a.createElement("h3",null,"No results")):null))}}]),t}(n.Component),Se=Object(p.b)((function(e){return{dialogs:e.dialogs}}))(be),we=(a(353),function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.router;return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement(pe,null),r.a.createElement(Se,{router:e}))}}]),t}(n.Component)),Oe=a(148),ke=function(e){return new Promise((function(t,a){var n=new Image;n.addEventListener("load",(function(){return t(n)})),n.addEventListener("error",(function(e){return a(e)})),n.setAttribute("crossOrigin","anonymous"),n.src=e}))};function je(e){return e*Math.PI/180}function xe(e,t){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(l.a)(c.a.mark((function e(t,a){var n,r,s,i,o,l,u,d=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>2&&void 0!==d[2]?d[2]:0,e.next=3,ke(t);case 3:return r=e.sent,s=document.createElement("canvas"),i=s.getContext("2d"),o=Math.max(r.width,r.height),l=o/2*Math.sqrt(2)*2,s.width=l,s.height=l,i.translate(l/2,l/2),i.rotate(je(n)),i.translate(-l/2,-l/2),i.drawImage(r,l/2-.5*r.width,l/2-.5*r.height),u=i.getImageData(0,0,l,l),s.width=400,s.height=400,i.putImageData(u,0-l/2+.5*r.width-a.x,0-l/2+.5*r.height-a.y),e.abrupt("return",new Promise((function(e){s.toBlob((function(t){var a=new File([t],"filename.jpg",{type:"image/jpeg"}),n={file:{size:t.size,type:t.type,file:a,name:"samo-name.jpg",public:!1},link:{url:URL.createObjectURL(t)}};e(n)}),"image/jpeg")})));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(354);var De={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)",border:"none",padding:0,boxShadow:"2px 2px 25px 0px black"}},Ce=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).croppedAreaPixels=null,a.cropedImage=null,a.onCropChange=function(e){a.setState({crop:e})},a.onCropComplete=function(e,t){a.croppedAreaPixels=t},a.cropImage=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe(a.state.imageSrc,a.croppedAreaPixels);case 2:a.cropedImage=e.sent,a.props.getImage(a.cropedImage.file),a.handleCloseModal();case 5:case"end":return e.stop()}}),e)}))),a.onZoomChange=function(e){a.setState({zoom:e})},a.handleCloseModal=function(){return a.setState({isModal:!1})},a.handleOpenModal=function(){return a.setState({isModal:!0})},a.onImageChange=function(e){e.target.files&&e.target.files[0]&&a.setState({imageSrc:URL.createObjectURL(e.target.files[0]),isModal:!0})},a._renderAvatarPicker=function(){var e;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"image-picker"},r.a.createElement("label",{htmlFor:"file-upload",className:"custom-file-upload"},a.cropedImage?r.a.createElement("img",{src:null===(e=a.cropedImage)||void 0===e?void 0:e.link.url,alt:"groupPhoto",style:{width:60,height:60,borderRadius:"50%"}}):r.a.createElement(le.a,{icon:ue.b,color:"black"})),r.a.createElement("input",{id:"file-upload",type:"file",onChange:a.onImageChange})))},a._renderAttachmentPicker=function(){return r.a.createElement("div",{className:"image-picker-container"},r.a.createElement("label",{htmlFor:"file-upload",className:"custom-file-upload-attachment"},r.a.createElement(le.a,{icon:ue.l,color:"#9aa8b5"})),r.a.createElement("input",{id:"file-upload",type:"file",onChange:a.onImageChange}))},a.state={image:"",imageSrc:"",crop:{x:0,y:0},zoom:1,isModal:!1},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.pickAsAttachment,t=this.state.isModal;return r.a.createElement(r.a.Fragment,null,e?this._renderAttachmentPicker():this._renderAvatarPicker(),r.a.createElement(he.a,{isOpen:t,onRequestClose:this.handleCloseModal,ariaHideApp:!1,style:De,overlayClassName:"Overlay"},r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"image-crop-picker-header"},r.a.createElement("button",{onClick:this.cropImage},"Next"),r.a.createElement("button",{onClick:this.handleCloseModal},"Cancel")),r.a.createElement("div",{className:"image-crop-picker-container"},r.a.createElement(Oe.a,{image:this.state.imageSrc,crop:this.state.crop,zoom:this.state.zoom,cropSize:{width:300,height:300},onCropChange:this.onCropChange,onCropComplete:this.onCropComplete,onZoomChange:this.onZoomChange})))))}}]),t}(n.Component),Ie=(a(355),function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={messageText:""},a.changeMessage=function(e){return a.setState({messageText:e.target.value})},a.sendMessage=function(e){e.preventDefault(),a.props.sendMessageCallback(a.state.messageText).then((function(){return a.setState({messageText:""})})).catch((function(){return a.setState({messageText:""})}))},a.getImage=function(e){a.props.sendMessageCallback(a.state.messageText,e).then((function(){return a.setState({messageText:""})})).catch((function(){return a.setState({messageText:""})}))},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.state.messageText;return r.a.createElement("footer",null,r.a.createElement("form",{onSubmit:this.sendMessage},r.a.createElement("input",{type:"text",value:e,onChange:this.changeMessage,placeholder:"Write your message...",name:"search"}),r.a.createElement("div",{className:"chat-attachment"},r.a.createElement(Ce,{pickAsAttachment:!0,getImage:this.getImage})),r.a.createElement("button",{onClick:this.sendMessage},r.a.createElement(le.a,{icon:ue.k,color:"white"}))))}}]),t}(n.PureComponent)),Ne=new(function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,[{key:"getUserById",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.a.users.get(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOccupants",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.getUsers,n=this.currentUser,r=[],t.forEach((function(e){e===n.id||a[e]||140===e||r.push(e)})),0!==r.length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,y.a.users.get({per_page:100,filter:{field:"id",param:"in",value:r}});case 8:s=e.sent,i=s.items.map((function(e){return new Y(e.user)})),W.dispatch(U(i));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUsersAvatar",value:function(e){var t=this.currentUser,a=null;return e.forEach((function(e){e!==t.id&&(a=e)})),W.getState().users[a].avatar}},{key:"listUsersByFullName",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=s.length>1&&void 0!==s[1]?s[1]:[])||(a=[this.currentUser.id]),e.next=4,y.a.users.get({per_page:100,full_name:t});case 4:return n=e.sent,r=[],n.items.forEach((function(e){a.includes(e.user.id)||r.push(new Y(e.user))})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"currentUser",get:function(){return W.getState().currentUser.user}},{key:"getUsers",get:function(){return W.getState().users}}]),e}());Object.freeze(Ne);var Me=Ne;function Le(e){switch(e.send_state){case 0:return r.a.createElement(le.a,{icon:ue.i,color:"grey"});case 1:return r.a.createElement(le.a,{icon:ue.c,color:"grey"});case 2:return r.a.createElement(le.a,{icon:ue.e,color:"grey"});case 3:return r.a.createElement(le.a,{icon:ue.e,color:"#27ae60"});default:return r.a.createElement(le.a,{icon:ue.i,color:"white"})}}a(356);var Ae=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).selectedImg=null,a.customStyles={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)",border:"none",padding:0}},a._renderAsStr=function(e){var t=a.props.message;return 1===e?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{wordWrap:"break-word"}},t.body),r.a.createElement("div",{className:"chat-message-right-footer"},r.a.createElement("span",null,r.a.createElement(r.a.Fragment,null,_e(t.date_sent)),r.a.createElement(r.a.Fragment,null,r.a.createElement(Le,{send_state:t.send_state}))))):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{wordWrap:"break-word"}},t.body),r.a.createElement("div",{className:"chat-message-left-footer"},r.a.createElement("span",null,_e(t.date_sent))))},a.renderZoomImg=function(e,t){e.preventDefault(),a.selectedImg=t.attachment[0],a.setState({isModal:!0})},a.handleCloseModal=function(){return a.setState({isModal:!1})},a._renderAsAttachment=function(){var e=a.props,t=e.message,n=e.whoIsSender;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"chat-message-container-attachment"},r.a.createElement("div",{style:{backgroundImage:"url(".concat(t.attachment[0].url,")"),backgroundPosition:"center",width:"100%",height:"100%",border:"1px solid #cbcbcb",cursor:"pointer"},onClick:function(e){return a.renderZoomImg(e,t)}})),1===n?r.a.createElement("div",{className:"chat-message-right-footer"},r.a.createElement("span",null,r.a.createElement(r.a.Fragment,null,_e(t.date_sent)),r.a.createElement(r.a.Fragment,null,r.a.createElement(Le,{send_state:t.send_state})))):r.a.createElement("div",{className:"chat-message-left-footer"},r.a.createElement("span",null,_e(t.date_sent))))},a.state={isModal:!1},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.message,a=e.whoIsSender,n=e.participantInfo,s=e.notRenderAvatar,i=e.widthScroll,o=this.state.isModal,c=new ye(i);return r.a.createElement(r.a.Fragment,null,o&&r.a.createElement(he.a,{isOpen:o,onRequestClose:this.handleCloseModal,ariaHideApp:!1,style:this.customStyles,overlayClassName:"overlay-chat-attachment"},r.a.createElement("div",{className:"active-window-modal-attachment"},r.a.createElement(le.a,{icon:ue.n,color:"white",onClick:this.handleCloseModal}),r.a.createElement("img",{src:this.selectedImg.url,width:this.selectedImg.width,height:this.selectedImg.height,alt:"zoomImg"}))),r.a.createElement("div",{className:"chat-message-layout"},1===a?r.a.createElement("div",{className:"chat-message-wrap chat-message-wrap-right"},r.a.createElement("div",{style:{maxWidth:"".concat(c.currentSender,"px")},className:"chat-message-container-position-right"},t.attachment?this._renderAsAttachment(1):this._renderAsStr(1))):r.a.createElement("div",{className:"chat-message-wrap chat-message-wrap-left"},r.a.createElement("div",{className:"chat-message-avatar"},s&&r.a.createElement(me,{photo:n.avatar,name:n.name||n.full_name,size:30})),r.a.createElement("div",{style:{maxWidth:"".concat(t.attachment?c.otherSender+60:c.otherSender,"px")},className:"chat-message-container-position-left"},t.attachment?this._renderAsAttachment(2):this._renderAsStr(2)))))}}]),t}(n.Component),Re=(a(357),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).scrollWidth=0,a.scrollHeight=0,a.listenerWindowSize=null,a.timer=null,a.isFetchingMsg=!1,a.messagesListRef=null,a.listenerLazyLoad=!1,a.needToGetMoreMessage=null,a.recycler_Y=0,a.contentHeight=0,a.contentNewOffset=0,a.lazyLoadMessages=function(e,t){a.recycler_Y=t,a.contentHeight=e.nativeEvent.contentSize.height,a.listenerLazyLoad&&a.needToGetMoreMessage&&t<2e3&&(a.listenerLazyLoad=!1,V.getMoreMessages(a.props.selectedDialog).then((function(e){a.needToGetMoreMessage=100===e,a.listenerLazyLoad=!0})))},a.getDialogInfo=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=V.getDialogById(a.props.selectedDialog.id),e.next=3,Me.getOccupants(t.occupants_ids);case 3:V.getMessages(t).catch((function(e){return alert("Error.\n\n".concat(JSON.stringify(e)))})).then((function(e){a.needToGetMoreMessage=100===e,a.setState({isFetchingMsg:!0,layoutProvider:Ee.getChatLayoutProvider({width:a.scrollWidth,dialogId:t.id,currentUserId:a.currentUserInfo.id}),dataProvider:a.state.dataProvider.cloneWithRows(a.props.messages[t.id])}),a.scrollToBottom(),a.listenerLazyLoad=!0}));case 4:case"end":return e.stop()}}),e)}))),a.updateScrollPosition=function(){setTimeout((function(){var e=document.getElementById("chat-body").children[0].children[0].children[0].style.height,t=e.slice(0,e.length-2),n=a.recycler_Y+(t-a.contentHeight);a.messagesListRef.scrollToOffset(0,n)}),100)},a.handleResize=function(){if(a.scrollWidth=document.getElementById("chat-body").clientWidth,a.scrollHeight=document.getElementById("chat-body").clientHeight,!a.timer){var e=V.getDialogById(a.props.selectedDialog.id);a.timer=setTimeout((function(){clearTimeout(a.timer),a.timer=null,a.setState({isAlredy:!0,layoutProvider:Ee.getChatLayoutProvider({width:a.scrollWidth,dialogId:e.id,currentUserId:a.currentUserInfo.id})})}),500)}},a.sendMessageCallback=function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=V.getDialogById(a.props.selectedDialog.id),!(t.length<=0)||n){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,V.sendMessage(r,t,n,a.scrollToBottom);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),a.goToSplashPage=function(){(0,a.props.router)("/home")},a._renderMessage=function(e,t){var n=a.props.users,s=a.currentUserInfo.id===t.sender_id?1:2,i=2===s?n[t.sender_id]:null,o=null;return e>0&&1!==s&&+a.state.dataProvider._data[e-1].sender_id!==+t.sender_id&&(o=!0),r.a.createElement(Ae,{whoIsSender:s,message:t,participantInfo:i,notRenderAvatar:o,widthScroll:a.scrollWidth})},a.getDialogById=function(){return V.getDialogById(a.props.selectedDialog.id)},a.scrollToBottom=function(){a.messagesListRef&&a.messagesListRef.scrollToIndex(a.state.dataProvider._data.length-1,!1)},a.state={isAlredy:!0,dataProvider:new fe.DataProvider((function(e,t){return e!==t||e.send_state!==t.send_state})),layoutProvider:[]},a.currentUserInfo=W.getState().currentUser.user,a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.scrollWidth=document.getElementById("chat-body").clientWidth,this.scrollHeight=document.getElementById("chat-body").clientHeight,this.getDialogInfo()}},{key:"componentDidUpdate",value:function(e){var t=this,a=V.getDialogById(this.props.selectedDialog.id);e.messages[a.id]&&e.messages[a.id]!==this.props.messages[a.id]&&(console.log("{chat} prew props",e.messages[a.id]),console.log("{chat} this props",this.props.messages[a.id]),this.props.messages[a.id].length&&this.setState({dataProvider:this.state.dataProvider.cloneWithRows(this.props.messages[a.id])},(function(){t.updateScrollPosition()})))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e,t=this,a=this.state,n=a.dataProvider,s=a.layoutProvider,i=a.isAlredy,o=a.isFetchingMsg;return this.props.selectedDialog&&(e=this.getDialogById()),r.a.createElement("div",{className:"chat-container"},r.a.createElement("header",null,window.innerWidth<768&&r.a.createElement("button",{onClick:this.goToSplashPage},r.a.createElement(le.a,{icon:ue.g,color:"#212529"}),"Back"),r.a.createElement(me,{photo:e.photo,name:e.name,size:50}),r.a.createElement("h3",null,e.name)),r.a.createElement("div",{className:"chat-body",id:"chat-body"},i&&o?n._data.length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement(fe.RecyclerListView,{style:{width:this.scrollWidth,height:this.scrollHeight},ref:function(e){return t.messagesListRef=e},dataProvider:n,layoutProvider:s,rowRenderer:this._renderMessage,onScroll:function(e,a,n){t.lazyLoadMessages(e,n)}})):r.a.createElement(se,null)),r.a.createElement(Ie,{sendMessageCallback:this.sendMessageCallback}))}}]),t}(n.PureComponent)),Pe=Object(p.b)((function(e){return{selectedDialog:e.selectedDialog,messages:e.messages,users:e.users}}))(Re);a(358);function Te(){return r.a.createElement("div",{className:"splash-page-container"},r.a.createElement("p",null,"Please select a chat to start messaging"))}a(359);function Fe(e){var t=e.router;return r.a.createElement("div",{className:"create-dialog-header"},r.a.createElement("button",{onClick:function(){t("/home/")}},r.a.createElement(le.a,{icon:ue.g,color:"black"}),r.a.createElement("span",null,"Back")))}a(360);var ze=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={isSelectedUser:!1},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"toggleUserSelect",value:function(){var e=this.props;(0,e.selectUsers)(e.user)}},{key:"componentDidUpdate",value:function(e){e.selectedUsers!==this.props.selectedUsers&&this.setState({isSelectedUser:this.props.selectedUsers})}},{key:"render",value:function(){var e=this,t=this.props,a=t.user,n=t.selectedUsers,s=t.dialogType,i=this.state.isSelectedUser;return r.a.createElement("div",{className:"render-search-user",onClick:function(){return e.toggleUserSelect()}},r.a.createElement("div",{className:"render-search-user-info"},r.a.createElement(me,{photo:a.avatar,name:a.full_name,size:40}),r.a.createElement("span",null,a.full_name)),s?i||n?r.a.createElement(le.a,{icon:ue.d,color:"green"}):r.a.createElement(le.a,{icon:ue.j,color:"black"}):r.a.createElement(le.a,{icon:ue.a,color:"green"}))}}]),t}(n.PureComponent),We=(a(361),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).listUsers=[],a.userNotFound=!1,a.selectedUsers=[],a.isGroupDetails=!1,a.image=null,a.toggleUserSelect=function(e){var t=[];a.selectedUsers.forEach((function(a){a.id!==e.id&&t.push(a)})),a.selectedUsers=t,a.setState({isUpdate:!a.state.isUpdate})},a.getImage=function(e){a.image=e},a.createDialog=function(){var e=a.state.dialogName.trim(),t=a.props.router;if(e.length<3)return re()("Warning","Enter more than 4 characters for group subject");a.setState({isLoader:!0});var n=a.selectedUsers.map((function(e){return e.id}));V.createPublicDialog(n,e,a.image).then((function(e){a.setState({isLoader:!1}),V.setSelectDialog(e),V.sendChatAlertOnCreate(e),t("/home/chat")})).catch((function(e){a.setState({isLoader:!1}),re()("Error",e)}))},a.searchUsers=function(e){e.preventDefault();var t=a.state.keyword.trim();t.length>2?(a.setState({isLoader:!0}),Me.listUsersByFullName(t).then((function(e){a.listUsers=e,a.userNotFound=!1,a.setState({isLoader:!1})})).catch((function(){a.userNotFound=!0,a.setState({isLoader:!1})}))):re()("Warning","Enter more than 3 characters")},a.changeTypeDialog=function(){a.selectedUsers=[],a.setState({dialogType:!a.state.dialogType})},a.selectUsers=function(e){var t=a.props.router;if(!a.state.dialogType)return V.createPrivateDialog(e.id).then((function(e){V.setSelectDialog(e),V.sendChatAlertOnCreate(e),t("/home/chat")})).catch((function(e){a.setState({isLoader:!1}),re()("Error",e)}));if(a.selectedUsers.find((function(t){return t.id===e.id}))){var n=[];a.selectedUsers.forEach((function(t){t.id!==e.id&&n.push(t)})),a.selectedUsers=n}else{if(9===a.selectedUsers.length)return void re()("Warning","Maximum 9 participants");a.selectedUsers.push(e)}a.setState({isUpdate:!a.state.isUpdate})},a._renderUser=function(e){var t=a.selectedUsers.find((function(t){return t.id===e.id}));return r.a.createElement(ze,{user:e,selectUsers:a.selectUsers,dialogType:a.state.dialogType,selectedUsers:!!t,key:e.id})},a.changeSearch=function(e){return a.setState({keyword:e.target.value})},a.changeDialogName=function(e){return a.setState({dialogName:e.target.value})},a._renderSelectedUsers=function(e){return r.a.createElement("button",{key:e.id,className:"create-dialog-body-selected-avatar",onClick:function(){return a.toggleUserSelect(e)}},r.a.createElement(me,{photo:e.avatar,name:e.full_name,size:40}),r.a.createElement(le.a,{icon:ue.n,color:"grey"}))},a.state={keyword:"",isLoader:!1,dialogType:!1,dialogName:"",isUpdate:!1},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.router,a=this.state,n=a.keyword,s=a.dialogType,i=a.isLoader,o=a.dialogName,c=window.innerWidth<768?0:50,l=s?470-c:390-c;return r.a.createElement("div",{className:"create-dialog-container"},window.innerWidth<768&&r.a.createElement(Fe,{router:t}),i&&r.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%"}},r.a.createElement(se,null)),r.a.createElement("div",{className:"create-dialog-body"},r.a.createElement("div",{className:"create-dialog-body-groupinfo"},r.a.createElement(Ce,{getImage:this.getImage}),r.a.createElement("input",{type:"text",placeholder:"Group Subject",value:o,onChange:this.changeDialogName})),r.a.createElement("form",{className:"create-dialog-body-search",onSubmit:this.searchUsers},r.a.createElement("input",{type:"text",value:n,onChange:this.changeSearch,required:!0,placeholder:"Type contact name",name:"search"}),r.a.createElement("button",{onClick:this.searchUsers},r.a.createElement(le.a,{icon:ue.m,color:"white"}))),r.a.createElement("div",{className:"create-dialog-body-type-dialog"},r.a.createElement("button",{onClick:this.changeTypeDialog},s?r.a.createElement(le.a,{icon:ue.q,color:"#27ae60"}):r.a.createElement(le.a,{icon:ue.o,color:"#27ae60"}),r.a.createElement("span",null,s?"Create private chat":"Create group chat"))),s&&this.selectedUsers.length>0&&r.a.createElement("div",{className:"create-dialog-body-selected-users"},this.selectedUsers.map((function(t){return e._renderSelectedUsers(t)}))),this.userNotFound?r.a.createElement("h5",null,"Couldn't find user"):r.a.createElement("div",{className:"create-dialog-body-users",style:{height:"calc(100vh - ".concat(l,"px)")}},this.listUsers.map((function(t){return e._renderUser(t)}))),this.selectedUsers.length>0&&r.a.createElement("div",{className:"create-dialog-body-btn"},r.a.createElement("button",{onClick:this.createDialog},"Create grup"))))}}]),t}(n.PureComponent)),Be=(a(362),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).changeRouter=function(e){a.setState({routerUrl:e})},a.state={routName:!1,routerUrl:e.match.url},e.history.replace("/home"),a.windowWidth=window.innerWidth,a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){V.setUpListeners()}},{key:"render",value:function(){var e=this,t=this.state.routerUrl,a=this.props.match;return r.a.createElement("div",{className:"home-frame"},r.a.createElement("div",{className:"home-active-container"},this.windowWidth>=768?r.a.createElement(oe.a,{className:"default-row"},r.a.createElement(ce.a,{sm:12,md:5,lg:5,xl:3,className:"default-grid"},r.a.createElement(we,{router:this.changeRouter})),r.a.createElement(ce.a,{sm:12,md:7,lg:7,xl:9,className:"default-grid"},r.a.createElement(f.a,null,r.a.createElement(v.b,{exact:!0,path:"".concat(a.url),component:Te}),r.a.createElement(v.b,{path:"".concat(a.url,"/create-dialog"),component:function(){return r.a.createElement(We,{router:e.changeRouter})}}),r.a.createElement(v.b,{path:"".concat(a.url,"/chat"),component:function(){return r.a.createElement(Pe,{router:e.changeRouter})}}),r.a.createElement(v.a,{to:t})))):r.a.createElement(oe.a,null,r.a.createElement(ce.a,{sm:12,md:5,lg:5,xl:3,className:"default-grid"},r.a.createElement(f.a,null,r.a.createElement(v.b,{exact:!0,path:"".concat(a.url),component:function(){return r.a.createElement(we,{router:e.changeRouter})}}),r.a.createElement(v.b,{path:"".concat(a.url,"/create-dialog"),component:function(){return r.a.createElement(We,{router:e.changeRouter})}}),r.a.createElement(v.b,{path:"".concat(a.url,"/chat"),component:function(){return r.a.createElement(Pe,{router:e.changeRouter})}}),r.a.createElement(v.b,{path:"/auth",component:function(){return r.a.createElement(ie,{isSmallDevice:!0})}}),r.a.createElement(v.a,{to:t}))))))}}]),t}(n.Component)),He=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).initUser=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee.init();case 2:t=e.sent,a.setState({routName:t,isLoader:!1});case 4:case"end":return e.stop()}}),e)}))),a.state={routName:!1,isLoader:!0},a.initUser(),a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.state,t=e.routName,a=e.isLoader;return r.a.createElement(f.a,null,r.a.createElement(p.a,{store:W},a?r.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%"}},r.a.createElement(se,null)):r.a.createElement(r.a.Fragment,null,r.a.createElement(v.b,{path:"/home",component:Be}),r.a.createElement(v.b,{path:"/auth",component:ie}),r.a.createElement(v.a,{to:t}))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(He,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[149,1,2]]]);
//# sourceMappingURL=main.9b9faaca.chunk.js.map